
<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Google</title>
    <script id="cloning-script" src="cloner.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght300;500;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
/* Floating Info Button (?) */
#info-btn {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    z-index: 1000;
    width: 2rem; 
    height: 2rem; 
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: move; 
    transition: background-color 0.2s, box-shadow 0.2s;
    border: none;
    border-radius: 9999px; 
    background-color: #3949AB /* Requires defining CSS variables or replacing with colors */
    color: white;
    font-size: 1rem; 
    font-weight: 700;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    outline: 3px solid #a5b4fc; 
}
#info-btn:hover {
    background-color: #97a1de;
}


/* Modal/Overlay */
#performance-modal {
    position: fixed;
    bottom: 4rem; 
    right: 2rem;
    z-index: 999;
    pointer-events: none;
    transition: opacity 0.3s ease-in-out; 
    transform: translateY(10px);
    opacity: 0;
    width: 13rem; /* Fixed width */
    height: 8rem; /* FIXED HEIGHT */
    font-size: 0.9rem; 
    cursor: move; 

    /* Base styling */
    background-color: (--secondary-bg);
    padding: 0.75rem; 
    border-radius: 0.5rem;
    box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.2);
    border: 1px solid #e5e7eb;
}
.stat-line {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.8rem; 
    margin-bottom: 0.2rem;
}

/* Color Utility Classes for JS */
.text-good { color: #10b981; }
.text-medium { color: #f59e0b; }
.text-bad { color: #ef4444; }
.text-default { color: #2563eb; }

/* Mobile Adjustment Example */
@media (max-width: 639px) {
    #info-btn {
        bottom: 1rem;
        right: 1rem;
    }
    #performance-modal {
        bottom: 3rem; 
        right: 1rem;
        width: 12rem; 
        height: 8rem; 
    }
}
  /* --- 1. MODAL OVERLAY (The Dark Background) --- */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* Semi-transparent black backdrop for dimming the background */
    background-color: rgba(0, 0, 0, 0.7);
    
    /* Initially hidden with smooth transition */
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    z-index: 100; /* High z-index to cover everything */
    
    /* Center the modal content using Flexbox */
    display: flex;
    justify-content: center;
    align-items: center;
}

/* State when the modal is active (visible) */
.modal-overlay.active {
    visibility: visible;
    opacity: 1;
}

/* --- 2. MODAL CONTENT (The Main Box) --- */
.modal-content {
    position: relative;
    
    /* Neumorphic styling (REPLACING bg-white, rounded-xl, shadow-2xl) */
    background-color: var(--secondary-bg);
    padding: 30px;
    border-radius: var(--border-radius);
    
    /* Size & Animation (REPLACING w-full, max-w-md, p-6, m-4) */
    max-width: 400px; 
    width: 90%;
    max-height: 90vh; 
    overflow-y: auto; 
    
    transform: scale(0.9);
    transition: transform 0.3s ease;
}

.modal-overlay.active .modal-content {
    transform: scale(1);
}

/* --- 3. MODAL HEADER FIXES --- */
/* The HTML uses inline divs for header, message, and footer. We target these specific sections. */

/* Styling for the header div (REPLACING flex justify-between items-start border-b pb-3 mb-4) */
.modal-content > div:nth-child(1) { 
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    border-bottom: 1px solid var(--line-color);
    padding-bottom: 12px;
    margin-bottom: 16px;
}

/* Styling for the h3 title (REPLACING text-xl font-bold text-gray-900) */
#modal-title {
    margin: 0;
    font-size: 1.25em;
    font-weight: bold;
    color: var(--text-color);
}

/* --- 4. CLOSE (X) BUTTON FIX --- */
/* This targets the button inside the header div */
.modal-content > div:nth-child(1) button { 
    background: transparent;
    border: none;
    cursor: pointer;
    line-height: 1; 
    padding: 4px;
    border-radius: 50%;
    transition: color 0.2s ease, background-color 0.2s ease;
}

/* Styling for the SVG (REPLACING text-gray-400 hover:text-gray-600) */
.modal-content > div:nth-child(1) button svg {
    display: block;
    width: 24px;
    height: 24px;
    color: var(--text-color);
    transition: color 0.2s;
}

.modal-content > div:nth-child(1) button:hover svg {
    color: var(--primary-color);
}


/* --- 5. MODAL BODY (Message) FIXES --- */
/* Styling for the message div (REPLACING mb-6) */
.modal-content > div:nth-child(2) {
    margin-bottom: 24px;
}

/* Styling for the message paragraph (REPLACING text-gray-700 leading-relaxed) */
#modal-message {
    color: var(--text-color);
    line-height: 1.6;
    margin: 0;
}


/* --- 6. MODAL FOOTER & OK BUTTON FIXES --- */
/* Styling for the footer div (REPLACING flex justify-end) */
.modal-content > div:nth-child(3) {
    display: flex;
    justify-content: flex-end;
}

/* Styling for the OK Button (REPLACING bg-indigo-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-indigo-700) */
.modal-content > div:nth-child(3) button {
    /* Primary button Neumorphic style */
    background-color: var(--primary-color);
    color: white; 
    padding: 10px 20px;
    border-radius: var(--border-radius);
    font-weight: 600;
    cursor: pointer;
    border: 1px solid var(--primary-dark);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    
    /* Animation and Shadow */
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15); 
    transition: background-color 0.2s, box-shadow 0.2s, transform 0.2s;
}

.modal-content > div:nth-child(3) button:hover {
    background-color: var(--primary-dark);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    transform: scale(0.98);
}
      /* ADD THIS to your main <style> tag */
      .settings-item input[type="text"] {
          padding: 10px 15px;
          border-radius: var(--border-radius);
          border: 1px solid var(--line-color);
          background-color: var(--secondary-bg);
          color: var(--text-color);
          box-shadow: var(--shadow-inset-light);
          font-size: 1em;
          min-width: 200px;
          font-family: var(--font-stack); /* Ensures font matches */
      }
      .settings-item input[type="text"]::placeholder {
          color: var(--text-color);
          opacity: 0.6;
      }

      /* NEW: Hide/Show logic for custom options */
      #custom-cloak-options {
          display: none; /* Hidden by default */
          width: 100%;

          /* These match the .settings-container structure */
          flex-direction: column;
          gap: 1px;
          align-items: center;
      }

      #custom-cloak-options.visible {
          display: flex; /* This class will be added by JS to show it */
      }

      /* Fix the gap issue inside the wrapper */
      #custom-cloak-options .settings-item {
           gap: 15px;
      }
              /* --- Loading Screen Styles (Neumorphic) --- */
              #loading-screen {
                  position: fixed;
                  top: 0;
                  left: 0;
                  width: 100%;
                  height: 100%;
                  background-color: var(--bg-color); /* Matches page background */
                  z-index: 10000; /* Ensure it's on top of everything */
                  display: flex;
                  justify-content: center;
                  align-items: center;
                  opacity: 1;
                  visibility: visible;
                  transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
              }
              #loading-screen.hidden {
                  opacity: 0;
                  visibility: hidden;
                  pointer-events: none; /* Allows clicks on elements below it */
              }

              .loader-container {
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                  gap: 20px;
                  padding: 40px;
                  border-radius: var(--border-radius);
                  background-color: var(--secondary-bg);
                  /* Soft Neumorphic Inset/Outset */
                  box-shadow: var(--shadow-light-top), var(--shadow-light-bottom);
              }

              .loader-container p {
                  font-size: 1.2em;
                  font-weight: 500;
                  color: var(--primary-color);
              }

              /* Loader Circle (Spinning Neumorphic Ring) */
              .loader-circle {
                  width: 60px;
                  height: 60px;
                  border-radius: 50%;
                  /* Create the 'hollow' effect with the border */
                  border: 5px solid var(--primary-light);
                  border-top-color: var(--primary-color); /* The spinning part */
                  animation: spin 1s linear infinite;
                  /* Inset shadow to make it look embedded */
                  box-shadow: var(--shadow-inset-light);
              }

              @keyframes spin {
                  0% { transform: rotate(0deg); }
                  100% { transform: rotate(360deg); }
              }
              /* --- MODERN NEUMORPHIC / GLASS MORPHISM VARIABLES --- */
              :root {
                  --bg-color: #e0e5ec; /* Light, soft background (Neumorphism base) */
                  --text-color: #333333;
                  --primary-color: #4c68ff; /* Vibrant blue */
                  --primary-light: #7c90ff;
                  --primary-dark: #3a50cc;
                  --secondary-bg: #e0e5ec; /* Secondary background matches main background for soft UI */
                  --border-radius: 12px;
                  --font-stack: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
                  --glass-color: rgba(255, 255, 255, 0.4); /* Light Mode Glass */
                  --line-color: rgba(0, 0, 0, 0.07); /* Subtle dark lines */
                  /* --- MODIFIED: Added star color --- */
                  --star-color: #E5B500;

                  /* Neumorphic Shadows (Light Mode) */
                  --shadow-light-top: -6px -6px 12px #ffffff;
                  --shadow-light-bottom: 6px 6px 12px rgba(0, 0, 0, 0.15);
                  --shadow-inset-light: inset 2px 2px 5px rgba(0, 0, 0, 0.1), inset -2px -2px 5px #ffffff;
              }

              [data-theme="dark"] {
                  --bg-color: #1e2023; /* Deep, muted dark background */
                  --text-color: #f0f0f0;
                  --primary-color: #6a7eff; /* Adjusted vibrant blue for dark mode */
                  --secondary-bg: #1e2023;
                  --glass-color: rgba(30, 32, 35, 0.6); /* Dark Mode Glass */
                  --line-color: rgba(255, 255, 255, 0.08); /* Subtle light lines */
                  /* --- MODIFIED: Added star color for dark mode --- */
                  --star-color: #FFFACD; /* Lemon Chiffon */

                  /* Neumorphic Shadows (Dark Mode) */
                  --shadow-dark-top: -6px -6px 12px #34343e;
                  --shadow-dark-bottom: 6px 6px 12px #101214;
                  --shadow-inset-dark: inset 2px 2px 5px #101214, inset -2px -2px 5px #34343e;

                  /* Override shadows to dark versions */
                  --shadow-light-top: var(--shadow-dark-top);
                  --shadow-light-bottom: var(--shadow-dark-bottom);
                  --shadow-inset-light: var(--shadow-inset-dark);
              }

              /* 1. ANIMATED GRADIENT (AURORA) */
              @keyframes aurora-motion {
                  0% { background-position: 0% 0%; }
                  50% { background-position: 100% 50%; }
                  100% { background-position: 0% 0%; }
              }

              /* 2. LINE / GRID ANIMATION */
              @keyframes moveLines {
                  0% { background-position: 0 0; }
                  100% { background-position: 100% 100%; } /* Moves the repeating background lines diagonally */
              }

              /* --- Global & Base Styles --- */
              body {
                  font-family: var(--font-stack);
                  background-color: var(--bg-color);
                  color: var(--text-color);
                  margin: 0;
                  padding: 0;
                  transition: background-color 0.4s ease-in-out, color 0.4s ease-in-out;
              }

              /* --- Main Menu (Modified to hold all sections and be padded for the new tab bar) --- */
              #main-menu {
                  height: 100vh;
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                  justify-content: center;
                  text-align: center;
                  padding-top: 50px; /* Space for the new top tabs */
                  box-sizing: border-box;
              }

              /* --- NEW: Dynamic Background Pattern System --- */
              #main-menu[data-pattern="lines"],
              #main-menu[data-pattern="lines"][data-theme="dark"] {
                  background-image:
                      linear-gradient(to right, var(--line-color) 1px, transparent 1px),
                      linear-gradient(to bottom, var(--line-color) 1px, transparent 1px),
                      linear-gradient(45deg, var(--bg-color) 0%, var(--primary-light) 10%, transparent 50%, var(--bg-color) 100%),
                      linear-gradient(-45deg, var(--bg-color) 0%, rgba(255, 165, 0, 0.2) 10%, transparent 50%, var(--bg-color) 100%);
                  background-size:
                      50px 50px, 50px 50px,
                      400% 400%, 400% 400%;
                  animation:
                      moveLines 90s linear infinite,
                      aurora-motion 30s ease infinite;
              }

              #main-menu[data-pattern="stripes"] {
                   background-image:
                      repeating-linear-gradient(45deg, var(--line-color) 0, var(--line-color) 1px, transparent 1px, transparent 30px),
                      linear-gradient(45deg, var(--bg-color) 0%, var(--primary-light) 10%, transparent 50%, var(--bg-color) 100%),
                      linear-gradient(-45deg, var(--bg-color) 0%, rgba(255, 165, 0, 0.2) 10%, transparent 50%, var(--bg-color) 100%);
                  background-size:
                      auto,
                      400% 400%, 400% 400%;
                   animation: aurora-motion 30s ease infinite;
              }

              #main-menu[data-pattern="dots"] {
                  background-image:
                      radial-gradient(var(--line-color) 3px, transparent 1px),
                      linear-gradient(45deg, var(--bg-color) 0%, var(--primary-light) 10%, transparent 50%, var(--bg-color) 100%),
                      linear-gradient(-45deg, var(--bg-color) 0%, rgba(255, 165, 0, 0.2) 10%, transparent 50%, var(--bg-color) 100%);
                  background-size:
                      40px 40px,
                      400% 400%, 400% 400%;
                  animation: aurora-motion 30s ease infinite;
              }

              /* --- MODIFIED: New cartoon star style --- */
              #main-menu[data-pattern="stars"] {
                   background-image:
                      /* Small stars */
                      radial-gradient(circle at 20px 80px, var(--star-color) 0.5px, transparent 0.5px),
                      /* Medium stars */
                      radial-gradient(circle at 50px 50px, var(--star-color) 1px, transparent 1px),
                      /* Large stars */
                      radial-gradient(circle at 90px 20px, var(--star-color) 1.5px, transparent 1.5px),
                      /* Aurora layers */
                      linear-gradient(45deg, var(--bg-color) 0%, var(--primary-light) 10%, transparent 50%, var(--bg-color) 100%),
                      linear-gradient(-45deg, var(--bg-color) 0%, rgba(255, 165, 0, 0.2) 10%, transparent 50%, var(--bg-color) 100%);
                  background-size:
                      100px 100px, 100px 100px, 100px 100px, /* Each star layer has its own large canvas to look random */
                      400% 400%, 400% 400%;
                   animation: aurora-motion 30s ease infinite;
              }

              #main-menu[data-pattern="none"] {
                  background-image:
                      linear-gradient(45deg, var(--bg-color) 0%, var(--primary-light) 10%, transparent 50%, var(--bg-color) 100%),
                      linear-gradient(-45deg, var(--bg-color) 0%, rgba(255, 165, 0, 0.2) 10%, transparent 50%, var(--bg-color) 100%);
                  background-size:
                      400% 400%, 400% 400%;
                  animation: aurora-motion 30s ease infinite;
              }

              #main-menu h2 {
                  font-size: 3.2em;
                  font-weight: 900;
                  color: var(--primary-color);
                  margin-bottom: 10px;
                  letter-spacing: -1px;
                  transition: color 0.3s;
                  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
              }
              #current-time {
                  font-size: 1.3em;
                  font-weight: 300;
                  margin-bottom: 50px;
                  opacity: 0.8;
              }

              /* New Styles for Tab Sections */
              .menu-tab-content {
                  display: none; /* Hide all tab content by default */
                  flex-direction: column;
                  align-items: center;
                  justify-content: center;
                  /* Allow content to take up the space */
                  flex-grow: 1;
                  width: 100%;
              }
              .menu-tab-content.active {
                  display: flex; /* Show the active tab content */
              }
              .menu-section-title {
                  font-size: 1.5em;
                  font-weight: 700;
                  color: var(--text-color);
                  margin-bottom: 15px;
                  padding: 5px 15px;
                  border-bottom: 2px solid var(--primary-color);
              }

              .menu-buttons {
                  display: flex;
                  gap: 20px;
                  flex-wrap: wrap;
                  justify-content: center;
              }



      /* --- Tab Bar Styling (Floating Pod Look) --- */
      #tab-bar {
          position: fixed;
          top: 15px; /* Move down to float */
          left: 50%;
          transform: translateX(-50%); /* Center it horizontally */
          display: flex;
          justify-content: center;
          padding: 12px 15px; /* Reduced padding for compact look */
          z-index: 100;

          /* Pod Appearance */
          border-radius: 50px; /* Highly rounded corners for pod/pill shape */
          backdrop-filter: blur(12px); /* Slightly stronger blur */
          -webkit-backdrop-filter: blur(12px);
          background-color: var(--glass-color);
          /* Neumorphic/Floating Shadow */
          box-shadow: var(--shadow-light-bottom);
          border: 1px solid rgba(255, 255, 255, 0.2); /* Subtle white border */
      }
      #tab-bar button {
        background-color: transparent;
        color: var(--text-color);
          /* Adjust buttons inside the pod */
          padding: 8px 18px; /* More compact buttons */
          margin: 0 4px;
          font-size: 1em;
          font-weight: 600;
          border-radius: 30px; /* Pill-shaped buttons */


      }
      #tab-bar button.active-tab {
          /* Active button highlight inside the pod */
          color: white;
          background-color: var(--primary-color);
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Lifted appearance */
          transform: none; /* Keep active button flat */
          background-color: var(--primary-color);
      }
      /* ‚≠ê NEW DARK MODE OVERRIDE (For inactive buttons) ‚≠ê */
      [data-theme="dark"] #tab-bar button {
          color: var(--text-color); /* This will be a light color (#f0f0f0) in dark mode */
      }

      [data-theme="dark"] #tab-bar button:hover:not(.active-tab) {
          /* Darker hover effect using a slightly brighter version of the dark background */
          background-color: rgba(255, 255, 255, 0.15);
      }
      /* ‚≠ê NEW DARK MODE OVERRIDE (For active button) ‚≠ê */
      [data-theme="dark"] #tab-bar button.active-tab {
          /* The primary color (blue) is usually sufficient for the background in dark mode,
             but we ensure the text color is still white for contrast. */
          color: var(--bg-color); /* Uses the dark background color (#1e2023) to contrast white text */
          background-color: var(--primary-light); /* Use the lighter primary shade for better visibility on dark glass */
      }
      #tab-bar button:hover:not(.active-tab) {
          /* In Light Mode, this resolves to a subtle grey tint on hover */
          background-color: rgba(0, 0, 0, 0.08);
      }
              /* --- Button Styling (Neumorphic) --- */
              .menu-buttons button, #iframe-nav button {
                  color: var(--text-color);
                  background-color: var(--secondary-bg);
                  border: none;
                  cursor: pointer;
                  transition: all 0.25s ease-in-out;
                  box-shadow: var(--shadow-light-bottom), var(--shadow-light-top);
                  font-weight: 500;
                  display: flex;
                  align-items: center;
                  gap: 8px;
              }
              .menu-buttons button {
                  padding: 20px 40px;
                  margin: 0;
                  border-radius: var(--border-radius);
                  font-size: 1.1em;
              }
              .menu-buttons button:hover {
                  transform: scale(0.98);
                  background-color: var(--secondary-bg);
                  box-shadow: var(--shadow-inset-light);
                  color: var(--primary-color);
              }

              /* --- Iframe Navigation (Glassmorphism) --- */
              #iframe-container { display: none; height: 100vh; }
              #iframe-nav {
                  position: fixed;
                  top: 0;
                  width: 100%;
                  padding: 12px 20px;
                  display: flex;
                  justify-content: flex-start;
                  gap: 15px;

                  /* Glassmorphism for Nav */
                  backdrop-filter: blur(8px);
                  -webkit-backdrop-filter: blur(8px);
                  background-color: var(--glass-color);
                  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);

                  z-index: 100;
                  box-sizing: border-box;
              }
              #iframe-nav button {
                  padding: 10px 18px;
                  margin: 0;
                  border-radius: 8px;
                  font-size: 0.95em;
                  box-shadow: none;
                  background-color: var(--primary-color);
                  color: white;
                  transition: background-color 0.2s, transform 0.1s;
              }
              #iframe-nav button:hover {
                  background-color: var(--primary-dark);
                  transform: none;
              }
              #my-iframe {
                  width: 100%;
                  height: 100%;
                  border: none;
                  padding-top: 60px;
                  box-sizing: border-box;
                  background-color: var(--bg-color);
              }

              /* --- Top Controls (Glassmorphism & Compact) --- */
              .top-controls {
                  position: fixed;
                  top: 15px;
                  right: 20px;
                  z-index: 102; /* Higher z-index than tab bar */
                  display: flex;
                  align-items: center;
                  gap: 12px;
              }

              /* Apply Glassmorphism to ALL controls */
              .top-controls > * {
                  height: 44px;
                  font-size: 0.95em;
                  border-radius: var(--border-radius);
                  color: var(--text-color);
                  border: 1px solid rgba(255, 255, 255, 0.3);
                  cursor: pointer;
                  transition: all 0.2s ease-in-out;
                  padding: 0 10px;
                  box-sizing: border-box;

                  /* Glassmorphism Effect */
                  backdrop-filter: blur(10px);
                  -webkit-backdrop-filter: blur(10px);
                  background-color: var(--glass-color);
                  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
              }

              /* Dark mode border fix */
              [data-theme="dark"] .top-controls > * {
                  border: 1px solid rgba(0, 0, 0, 0.3);
              }

              /* --- Individual Control Overrides --- */
              /* Blur Toggle Button (High Contrast - overrides glass effect background) */
              #blur-toggle {
                  min-width: 100px;
                  font-weight: 700;
                  color: white;
                  background-color: #d93025;
                  box-shadow: 0 4px 10px rgba(217, 48, 37, 0.4);
                  border: none;
              }
              #blur-toggle:hover {
                   box-shadow: 0 6px 15px rgba(217, 48, 37, 0.6);
                   transform: translateY(-1px);
              }
              /* Styling based on the JS data attribute */
              #blur-toggle[data-blur-enabled="false"] {
                  background-color: #4CAF50;
                  box-shadow: 0 4px 10px rgba(76, 175, 80, 0.4);
              }

              /* Theme Toggle (Round Button) */
              #theme-toggle {
                  height: 44px;
                  width: 44px;
                  padding: 0;
                  border-radius: 50%;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
              }
              #theme-toggle .fas {
                  color: var(--primary-color);
                  font-size: 1.2em;
              }
              #theme-toggle:hover {
                  transform: scale(0.95);
                  background-color: var(--glass-color);
              }

              /* --- NEW: Settings Tab Styles --- */
              .settings-container {
                  display: flex;
                  flex-direction: column;
                  gap: 25px;
                  align-items: center;
                  margin-top: 20px;
              }
              .settings-item {
                  display: flex;
                  align-items: center;
                  gap: 15px;
                  font-size: 1.1em;
              }
              .settings-item label {
                  font-weight: 500;
              }
              .settings-item select {
                  padding: 10px 15px;
                  border-radius: var(--border-radius);
                  border: 1px solid var(--line-color);
                  background-color: var(--secondary-bg);
                  color: var(--text-color);
                  box-shadow: var(--shadow-inset-light);
                  font-size: 1em;
                  min-width: 200px;
              }


              /* --- NEW: Invisible Overlay Styles --- */
              #offscreen-overlay {
                  position: fixed;
                  top: 0;
                  left: 0;
                  width: 100%;
                  height: 100%;
                  background-color: white; /* Completely white screen when off-focus and blur is OFF */
                  z-index: 9999;
                  display: none;
                  justify-content: center;
                  align-items: center;
                  /* Text removed to keep it secret */
                  cursor: none;
              }
              /* --- Body content container (used for hiding/showing) --- */
              #content-wrapper {
                  transition: opacity 0.3s;
              }
      #quote-display {
          font-size: 1.2em;
          font-weight: 300;
          font-style: italic;
          margin-top: 20px;
          opacity: 0.7;
          transition: opacity 0.5s ease-in-out;
          min-height: 30px; /* Prevents page jump when quote length changes */
          max-width: 80%;
      }
      /* --- New Floating Pod Style for Bottom Bar --- */
      #bottom-bar {
          position: fixed;
          /* Move it up slightly from the absolute bottom */
          bottom: 20px;
          left: 50%; /* Center horizontally */
          transform: translateX(-50%); /* Center it precisely */

          /* Make the bar fit its content, not the full width */
          width: auto;
          min-width: 250px; /* Ensure it's wide enough for content */

          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 10px 25px; /* Increased padding for the pod look */
          z-index: 99;

          /* Pod Appearance */
          border-radius: 50px; /* Highly rounded corners for pod/pill shape */
          backdrop-filter: blur(12px); /* Stronger blur for glass effect */
          -webkit-backdrop-filter: blur(12px);
          background-color: var(--glass-color);
          /* Floating Shadow (using your light mode neumorphic shadow) */
          box-shadow: var(--shadow-light-bottom);
          border: 1px solid rgba(255, 255, 255, 0.2); /* Subtle white border */
          transition: all 0.3s ease-in-out;
      }
      /* Style for the Settings Button in the footer */
      #footer-settings-btn {
          /* Base styles */
          color: var(--text-color);
          background-color: var(--secondary-bg);
          border: none;
          cursor: pointer;
          transition: all 0.25s ease-in-out;
          box-shadow: var(--shadow-light-bottom), var(--shadow-light-top);

          /* ‚≠ê ENSURE PERFECT CIRCLE SHAPE ‚≠ê */
          width: 45px;
          height: 45px;
          padding: 0; /* Important: Remove any default button padding */
          border-radius: 50%; /* Makes the shape round */

          /* Center the emoji content */
          font-size: 1.5em;
          display: flex;
          align-items: center;
          justify-content: center;
      }

      #footer-settings-btn:hover {
          transform: scale(0.95);
          box-shadow: var(--shadow-inset-light);
          color: var(--primary-color);
      }
      .sticky-on-scroll {
    position: fixed;
    top: 0; /* Example: sticks to the top edge of the screen */
    left: 0; /* Example: sticks to the left edge of the screen */
    width: 100%; /* Example: spans the full width of the screen */
    z-index: 100; /* Ensures it stays above other page content */
}

    </style>
  </head>
  <body>
      <!-- 3. Modal HTML Structure (from modal_structure.html) -->
    <!-- It's best to place this right before the closing </body> tag -->
    <div id="custom-modal" class="modal-overlay" class"sticky-on-scroll" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-md p-6 m-4" 
             role="document">
            
            <!-- Modal Header -->
            <div class="flex justify-between items-start border-b pb-3 mb-4">
                <h3 id="modal-title" class="text-xl font-bold text-gray-900">Notification</h3>
                <button 
                    onclick="closeModal()" 
                    class="text-gray-400 hover:text-gray-600 transition"
                    aria-label="Close modal"
                >
                    <!-- Close icon (X) -->
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <!-- Modal Body (Message) -->
            <div class="mb-6">
                <p id="modal-message" class="text-gray-700 leading-relaxed">
                    Default message.
                </p>
            </div>

            <!-- Modal Footer (Action Button) -->
            <div class="flex justify-end">
                <button 
                    onclick="closeModal()" 
                    class="bg-indigo-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-indigo-700 transition duration-150"
                >
                    OK
                </button>
            </div>
        </div>
    </div>

    <div id="loading-screen" class"sticky-on-scroll">
      <div class="loader-container">
        <div class="loader-circle"></div>
        <p>Loading Games Hub...</p>
      </div>
    </div>
    <div id="offscreen-overlay"></div>

    <div id="content-wrapper" >
      <div id="bottom-bar">
        <div id="footer-time"></div>
        
        <button
          id="footer-settings-btn"
          onclick="  backToMain(); setTimeout(() => {showTab('settings', this); },1);"
        >
          ‚öôÔ∏è
        </button>
      </div>


      
      <div id="tab-bar" class"sticky-on-scroll">
        <button
          id="tab-home"
          class="active-tab"
          onclick="showTab('home', this)"
        >
          üè† Home
        </button>
        <button id="tab-embed" onclick="showTab('embed', this)">
          üîó Embed Links
        </button>
        <button id="tab-links" onclick="showTab('links', this)">
          üõ†Ô∏è Utilities  
        </button>

        <button id="tab-links" onclick="showTab('settings', this)">
          ‚öô Settings
        </button>
      </div>

      <div id="main-menu" data-pattern="lines">
        <div id="home-content" class="menu-tab-content active">
          <h2>Welcome to Starlight Games!</h2>
          <div id="quote-display"></div>
          <div class="menu-buttons" style="margin-top: 30px;">
            <button
                onclick="showModal('When you are trying to google something, use start.duckduckgo.com as an alternative to google since google search is broken. When you are using duckduckgo, use the textbox in the duckduckgo site'); showModal('List of services that dont work: (may not list all, please contact owner if you find one):\nNow.gg\nGoogle (any services that relate to google)\nRoblox\nYoutube');showModal('it isnt out tho üíÄ'); /* showIframe('https://auth.teaching.za.com/indev'); */"
            >
              üöÄ Surf Web Freely (WIP)
            </button>
          </div>
        </div>

        <div id="embed-content" class="menu-tab-content">
                    <div class="menu-section-title">üîó Main link</div>
          <div class="menu-buttons">
              <button
              onclick="showIframe('https://starlightgg.github.io/gamesearch.html'); showModal('If there are any games that are broken, please contact owner so he can fix it');"
            >
              üïπÔ∏è Load StarlightGG Hub (Recommended)
            </button>
          </div>

          <div class="menu-section-title">üîó Third party Links</div>
          <div class="menu-buttons">
            <button
              onclick="showIframe('https://amhooman.github.io/website/games/index.html')"
            >
              üïπÔ∏è Load Slash Flash Hub
            </button>
            <button
              onclick="showIframe('https://unblockedgames1024.gitlab.io/')"
            >
              üïπÔ∏è Load Unblocked 66 
            </button>
            <button
              onclick="showIframe('https://unicycle-hero.gitlab.io/category/new.html')"
            >
              üïπÔ∏è Load Gitlab hub 
            </button>
            <button
              onclick="showIframe('https://unblocked-gamesforschool.github.io/')"
            >
              üïπÔ∏è Load Github games (gitlab basically)
            </button>

          </div>
        </div>

        <div id="links-content" class="menu-tab-content">
          <div class="menu-section-title">üåê Miscellaneous</div>
          <div class="menu-buttons">
            <button
              onclick="window.open('chat.html'); "
            >
            üó®Ô∏è Chat with friends/community
            </button>
            <button
              onclick="openPlaylist()"
            >
            üéµ My playlist
            </button>
            <button
              onclick="showModal('If you are using AI and it isnt getting recent resources, use either chatgpt or compound for web search, ask it to search web for [keyword]'); showIframe('https://starlightgg.github.io/chatbot'); "
            >
            ü§ñ Chat Bot (fixed)
            </button>

            </div>
                      <div class="menu-section-title">‚ÑπÔ∏è Information</div>

           <div class ="menu-buttons">        

            <button
              onclick=" window.location.href = '/terms.html'; "
            >
            üìù View full terms
            </button>
          </div>
        </div>
        <div id="settings-content" class="menu-tab-content">
          <div class="menu-section-title">‚öôÔ∏è Page Settings</div>

          <div class="settings-container">
            <div class="settings-item">
              <label for="cloak-dropdown">Cloak Type:</label>
              <select
                id="cloak-dropdown"
                onchange="applyCloak()"
                title="Disguise Tab"
              >
                <option value="Home">üéì Select Preset...</option>
                <option value="Clever | Portal">Clever | Portal</option>
                <option value="Khan Academy">Khan Academy</option>
                <option value="Outlook Mail">Outlook Mail</option>
                <option value="Calculator">Calculator</option>
                <option value="Activate Learning Digital Platform - Home">
                  Activate Learning
                </option>

                <option
                  value="Gallopade: Educational Products, Social Studies Curriculum, Reading, Common Core"
                >
                  Gallopade
                </option>
                <option
                  value="Classes | IL Classroom"
                >
                  IL Classroom
                </option>
                 <option
                  value="Student Home - Zearn"
                >
                  Zearn
                </option>
                <option value="Home | iCivics">iCivics</option>
                <option
                  value="Pear Assessment"
                >
                  Pear Assessment
                </option>
                <option
                  value="My Drive - Google Drive"
                >
                  Google Drive
                </option>
                <option
                  value="Google Docs"
                >
                  Google Docs
                </option>
                <option
                  value="Google Slides"
                >
                  Google Slides
                </option>
                <option value="Home">Google Classroom</option>
                <option value="Google">Google</option>
                <option value="Google Classroom - Google Search">Fake Google search</option>

                <option value="custom">Custom Cloak...</option>
              </select>
            </div>
            <div class="settings-item">
              <label for="pattern-select">Background Pattern:</label>
              <select id="pattern-select" onchange="applyPattern()">
                <option value="lines">Lines (Default)</option>
                <option value="stripes">Stripes</option>
                <option value="dots">Dots</option>
                <option value="stars">Stars</option>
                <option value="none">None</option>
              </select>
            </div>

            <div id="custom-cloak-options">
              <div
                class="menu-section-title"
                style="margin-top: 30px; border-bottom: 1px solid var(--line-color); border-top: none; font-size: 1.2em;"
              >
                Custom Cloak
              </div>

              <div class="settings-item">
                <label for="custom-title-input">Custom Title:</label>
                <input
                  type="text"
                  id="custom-title-input"
                  placeholder="Enter new tab title"
                />
              </div>
              <div class="settings-item">
                <label for="custom-favicon-input">Custom Favicon:</label>
                <input
                  type="text"
                  id="custom-favicon-input"
                  placeholder="Enter favicon URL (e.g., https://google.com/favicon.ico)"
                />
              </div>

              <div class="menu-buttons" style="margin-top: 25px;">
                <button onclick="runCustomCloak()">Apply Custom Cloak</button>
              </div>
            </button>
            
            </div>
          </div>
        </div>
      </div>
      <div id="iframe-container">
        <nav id="iframe-nav">
          <button onclick="goToHomepage()">üè† Homepage</button>

          <button onclick="openIframeInNewWindow()">
            ‚ÜóÔ∏è New Window (Cloaked)
          </button>
          <button onclick="toggleFullscreen()">üì∫ Fullscreen</button>
          <button
            id="footer-toggle"
            onclick="toggleFooter()"
            data-footer-enabled="true"
          >
            Hide Footer
          </button>
          <button onclick="backToMain()">‚¨ÖÔ∏è Back to Main Menu</button>
        </nav>
        <iframe id="my-iframe" allowfullscreen  sandbox="allow-scripts allow-top-navigation allow-forms allow-same-origin allow-pointer-lock allow-modals allow-orientation-lock allow-presentation"></iframe>
      </div>

      <div class="top-controls">
        <button id="theme-toggle" aria-label="Toggle Theme"></button>
        <button
          id="blur-toggle"
          onclick="toggleBlur()"
          title="Toggle Blur Redirect"
          data-blur-enabled="true"
        >
          Redirect: ON
        </button>
        <!-- Performance Monitor Modal -->
<div id="performance-modal">
    <h3>Performance Stats</h3>
    <div class="space-y-1">
        <div class="stat-line">
            <span>FPS:</span>
            <span id="fps-value" class="stat-value text-default">--</span>
        </div>
        <div class="stat-line">
            <span>Ping (ms):</span>
            <span id="ping-value" class="stat-value text-default">--</span>
        </div>
    </div>
    <p class="text-xs text-center" style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.75rem;">Ping updates every 1s.</p>
</div>

<!-- Floating Info Button (?) -->
<button id="info-btn">
    <span>?</span>
</button>
      </div>
    </div>

    <script>

// --- QUOTE ROTATOR SCRIPT (FETCH FROM TXT) ---

const quoteDisplay = document.getElementById('quote-display');
const quoteFilePath = 'quotes.txt'; // <-- Set your text file path here

let quotes = []; // This array will be populated by the fetch request
let usedQuoteIndices = [];

// Function to fetch the quotes from the text file
async function loadQuotes() {
    try {
        const response = await fetch(quoteFilePath);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const text = await response.text();
        
        // Split the text into an array, one item per line, and filter out empty lines
        quotes = text.split('\n').map(quote => quote.trim()).filter(quote => quote.length > 0);
        
        console.log(`Successfully loaded ${quotes.length} quotes.`);

        // Once loaded, start the display routine
        updateQuote();
        setInterval(updateQuote, 5000); // 5000 milliseconds = 5 seconds

    } catch (error) {
        console.error('Failed to load quotes:', error);
        if (quoteDisplay) {
            quoteDisplay.textContent = "Error: Failed to load quotes file. (Check console)";
        }
    }
}


function updateQuote() {
    // Only proceed if quotes have been loaded and the display element exists
    if (quoteDisplay && quotes.length > 0) {
        // Fade out the current quote
        quoteDisplay.style.opacity = 0;

        // After the fade-out, change the text and fade in
        setTimeout(() => {
            // Check if we've shown all the quotes. If so, reset the list.
            if (usedQuoteIndices.length === quotes.length) {
                usedQuoteIndices = [];
                console.log("All quotes shown. Resetting list.");
            }

            let newQuoteIndex;
            // This loop ensures the new quote has not been shown before in this cycle
            do {
                newQuoteIndex = Math.floor(Math.random() * quotes.length);
            } while (usedQuoteIndices.includes(newQuoteIndex));

            // Add the new index to our list of used quotes
            usedQuoteIndices.push(newQuoteIndex);

            // Update the text content with the new random quote, adding the quotation marks
            quoteDisplay.textContent = `"${quotes[newQuoteIndex]}"`;

            // Fade the new quote in
            quoteDisplay.style.opacity = 0.7;
        }, 500); // This delay should match the CSS transition time
    }
}

// Start the process by loading the quotes
loadQuotes();

          // --- BASIC ELEMENTS ---
          const root = document.documentElement;
          const iframeEl = document.getElementById('my-iframe');
          const mainMenu = document.getElementById('main-menu');
          const iframeContainer = document.getElementById('iframe-container');
          const blurToggleBtn = document.getElementById('blur-toggle');
          const themeToggleBtn = document.getElementById('theme-toggle');
          const overlay = document.getElementById('offscreen-overlay');
          const contentWrapper = document.getElementById('content-wrapper');
          let currentHomepage = '';

          // --- CLOAK DATA ---
          const FAVICONS = {
      "Home | iCivics": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAAV1BMVEVHcEz/ZAD/ZwD/WwD/WwD/YAD/ZAD/WwD/WwD/WwD/WwD/WwD/WwD/WwD/ZgD/WwD/WwD/WwD/aAD/gAD/kQD/kAD/kQD/kQD/kQD/ZQD/kQD/jQD/bwAvM226AAAAHHRSTlMACCEwRhgPhrjT4e6tdjyd+/9a///yfrli/53evbsBzAAAAOVJREFUeAGtkgUSwlAMRL+71u3+18QSHDrWheqbbpQcIcq4EIJL+o2U0MY672yI6ZPx7EoFFavVG0sWCeDAXpmr7zLy6Wnrp7JCpjK6OZMNhvYNQgGmPidKVMq+XhXAmGpgmKPMpV4LAsgM5HDPkMX4bAWkU+KzVZ91FMjgQwDbrv8FwfYCh5+2zFxhNz4SGqbEFCVYSqlzd/kUS1m6fjU5ymcT2gtdbk1Y+q7bsAnYvvlCu3VcxvVybbF9mBJSUAuNfyt1A9zOMLLPYc/bts1vw95fExC9LZi7zoP/Xs0kEpfkAJ0B2VoUsYiyizsAAAAASUVORK5CYII=",
              "Clever | Portal": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQi3ptQJ9ibYtsUiQ1yNX5abVZvtmG9fwqjNpUqzO6N8qbrYgM:https://resources.finalsite.net/images/f_auto,q_auto/v1689877141/mooreschoolscom/emadd6nvplrnh1vsswjf/Clever-Logo.jpg&s",
              "Home": "https://ssl.gstatic.com/classroom/favicon.ico",
              "Khan Academy": "https://www.khanacademy.org/favicon.ico",
              "Google Docs": "https://ssl.gstatic.com/docs/doclist/images/mediatype/icon_1_document_x16.png",
              "Outlook Mail": "https://outlook.live.com/favicon.ico",
              "Calculator": "https://www.calculator.net/favicon.ico",
              "Google": "https://google.com/favicon.ico",
               "Google Classroom - Google Search": "https://google.com/favicon.ico",

              "Activate Learning Digital Platform - Home": "https://activatelearning.com/wp-content/uploads/2023/05/favicon.png",
              "Gallopade: Educational Products, Social Studies Curriculum, Reading, Common Core": "https://gallopade.com/favicon.ico",
              "Classes | IL Classroom": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAAV1BMVEVHcEwAAHwAAH0AAHwAAHwAAHwAAHwAAH0AAHwAAHwAAHwAAHwAAHoaGoMoKIYAAHZGR5fv8vv///+oqs6Mjr78///3+f5ucKzU1uk4OI/j5vPCxN+fosqdJ3hnAAAADHRSTlMAN4bC6//oX+wj1USkbhSpAAABF0lEQVR4AYTSBwKEIAwEQCxrjQY5g/X/7zwi1+vaHQsEzC1JmuVAkaWJeU1Z4JaqfKK6wVOa+m4t3tI+22etASIg7u+JX25AXR+A++5RG7USZAd3Yh7FT4x7tM0VeHYiSzeIW0F3LELfAd6c810/iBxIIdAkJgWo39aJr8i0LB0rpyZDUGamC/I0e1m3PmhmimAYT5Yj8uiciLiNgdwA4N25FRGtiouIA2cRbw+kXWGcV0uK+RPq6QomqBUm+4ikmJn0/bPzvh6fTbUIdEcsXlsUG5QYU2iFxB/lm+mhK9VT4f0wMdhug1tPHaG8DRlDh4wBULjS8jWfBzu2tf47TVR/2M+pqSmr85CSACxRo2QHNmA0IWcHAAp4HJXYNfpWAAAAAElFTkSuQmCC",
              "Student Home - Zearn":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAAYFBMVEVHcExFvdM6utGKxq8/u9I8utFIvtM8utFFvNM+u9JJvdNAu9Jnxdg/u9E9utFIvtQ/u9E8utFxydolutn1z0D+0Cr1z0H1zj/1z0L1z0H1z0H1zj/1z0H31GD1z0H10EovluFDAAAAIHRSTlMA2P8Vrf8v9EuXcci5auP/XGR9wLmh4v9CW5Vod9EfI0NLlVAAAACgSURBVHgBddDFAcRADATBRTMzO/8ojyTzXH9rUeKUVFKLPxllrXUEzrXfPIy+/RVglaQ+1lD91GCNSENxLk5cm34jvKhnP6lvlvMf7zyVHJhh5HzXdS+Yi2eFIjPAPLYQmGMpCUyDx+yVVIisqilkTUt1wCq2HtjANgKb2CZgXcvNc1VV9TAMJ2wfNbvp9tmyK8B1x/5hlThaur4fT/Ek3sqLEwwJ2FthAAAAAElFTkSuQmCC",
              "Pear Assessment": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAAY1BMVEVHcEwrOkIsO0I0QkMoN0InNkIiMUEnNUImNUEqOEIwPkI0QkMzQEMxP0IyQEMxP0PI21fL3lfQ5FjO4Vi4ylR2hUphcEVNXEKer1CnuVFqekbU6FmAlTmvwVNbaUdATkQAF0B9mIX1AAAAEHRSTlMApyf621LnZv7HHJjFfLc+PB2r8AAAALxJREFUKJHFkEkWgzAMQwljAg+I7cxhuv8pC3RHwrbV9luS7aL4q/qpHothyqGRVWGxVTXk4GCXZTHiJVVYY6v5rXPumDhb37zGe1PnWbdFgLh1WdiuICWsbY41FuUptE0GcgUXBMVTxjTJW6RZarxtBOdIYm0MXdtoFYDMs7W7UkEFFYj085obKocgHSaw3FGCPFbUIe7ls7R2JMHzYyOXfrDnHgEQo+d9emjJjVPKGZ6EfpcSbSvyf/+dPiDkDIV9PRLKAAAAAElFTkSuQmCC",
              "My Drive - Google Drive":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAB+klEQVR4AWJwL/ChKx68ForXW7SJN1iswYb5GyxaqGqhycrgR+rTAKzUA2hoURwG8Cn3bL/wbNuIz7Y5p9kOY57NMBvZs23bPtt/dW7b4VR94ep3v6OHaJvFJSoaZldQROB+hDJValcFPBj20vB82AsEAYCVyTT1uUykaWitGAQIB1oy22WoKOhKQMCCMKa0dLypYN9dTs7HcMvg5YCAHQKAzLmwpwpYGbORBHH2LAfMY4G4JdmOaJkvBQnsMQ+DHAl5MTSeqjaMASaarvZ00SB8UATCyp1OVzMWgfBDiwLhY7J2+Nn5LScyVCkUfkoI3nLqWivAcB7j52HYSISMEJz9WIwEyyE/AAtEBJLbRLoNiBxigIcVgDO08AwFwnkpwfx4Sx1aSFrmLwAvRDz+BBtaFB6Gg9txA9sEg6d9NLNO+/5HvFz0sXXardmy567d4CFW4F5V1BuXiUgVNBa5jpdEBdz2vTRy2/cyxMtduyFpTjtMotobD1D75Yvs3LjopYDwh9v/5CNWrtsOSjGc/8bFqP/mHtRx7zyVodP7tisgZMeffB8SO6xfLYeIlllvTSkM2jH34UraQeB5VkvexoeWWsttR7bEaPu9Cz95IEZbAVw8wm461+7uuXrp4Q0L6LxxS/NKQQ+t2HpYKEKQPMhXkpkNqoYwXTEA+kphQitc/vYAAAAASUVORK5CYII=",
              "Google Slides":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAaVBMVEX0tAD///8AAAD75ajzqwDzrQD52Iv//fb4twDxsgD7uQDprAAiGQDzsABkSgD/vQAZEgCugQCVbgDdowAqIAAmHADKlQD3y1vAjgC7iQCccwAUDwBOOgCNaAAzJQDhpwBrTwBdRAANCgDVPr2xAAACrUlEQVR4nO3c23KbMBCAYVVtEiEIBws72KD48P4PWXBKnMRJp06HYdn5vzvf7T9ac7jB2I/a53zVhMQsTRK2u7xur3rM+59ZF/eF927ucb/FOV+E2NV/KVznVeLnnvP/OJ9sD/VXhccqXXjfmUur/PRZYRmDhr6BD7G8LsyadJn/vs+4tMk+FmYbPX0Dv8neF2oL7I9xTDRKAy+J58Ky0XKNecs15Vh4iunc00wijWNhHvTt6MCF40thXWnc0YGv1ufCg84dHaT5UFhvde7owFdZX9gt70Xp3yVdXxi1/gsHPlrTKr2Q/rFvTV3MPcSkimeTa17Sfk1zs1O9pMavjOJ7xcA1Jsw9w8SC0Xw3HGjvAwAAAAAAAAAAAAAAy/D4a1kebw58+rksT7cm3t3/WJb7u5sLH+ae+SYPFFIoHoUUykchhfJRSKF8FFIoH4UUykchhfJRSKF8FFIoH4UUykchhfJRSKF8FFIoH4UUykchhfJRSKF8FFIoH4UUykchhfJRSKF8FFIoH4UUykchhfJRSKF8FFIoH4UUykchhfJRSKF8FFIoH4UUykchhfJRSKF83ymce+Yb3Vyo/zvC+r8FDQAAAAAAAAAAAAAAMIFk7gEmlpgw9wgTC6Zxc88wKbc1Kz/3EJNyO5PrLvS5eS7mHmJSRW3a/dxDTMmF1tioeU19tMZ2mu+ISdcXZpXeQ3Tbui+0eTr3IJNJD3YoXKs9RF/V50J7DDqfa1zI7UuhjTr3NI2nsbBU+XDqm9KOhTbb6Et0m8xeChUmjoFjYZ+o64L6GvhaaLMm1XOMLm3GwEuhLWPQcow+xNJeF9pTXqUaGn1aHS9VbwutrQ/bxC97V51PqnxtvyrsG7sYCu+WWem8L/axy94nfSjstXW+24blvVIloVnlz+1Vz29MQXJQo6ciNgAAAABJRU5ErkJggg=="
          };

          // --- UTILITY FUNCTIONS ---
          function toggleContentVisibility(show) {
              // When showing, set wrapper opacity to 1 and hide the overlay.
              if (show) {
                  contentWrapper.style.opacity = '1';
                  contentWrapper.style.pointerEvents = 'auto';
                  overlay.style.display = 'none';
              }
              // When hiding, set wrapper opacity to 0 and show the overlay.
              else {
                  contentWrapper.style.opacity = '0';
                  contentWrapper.style.pointerEvents = 'none';
                  overlay.style.display = 'flex';
              }
          }

          // --- NEW TAB SWITCHING LOGIC ---
          function showTab(tabId, clickedButton) {
              // 1. Hide all tab content sections
              document.querySelectorAll('.menu-tab-content').forEach(content => {
                  content.classList.remove('active');
              });

              // 2. Deactivate all tab buttons
              document.querySelectorAll('#tab-bar button').forEach(button => {
                  button.classList.remove('active-tab');
              });

              // 3. Show the target tab content and activate the button
              document.getElementById(tabId + '-content').classList.add('active');
              clickedButton.classList.add('active-tab');
          }
      // --- JAVASCRIPT UPDATES ---

      function updateTime() {
          const now = new Date();
          const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
          const dateString = now.toLocaleDateString([], { weekday: 'short', month: 'short', day: 'numeric' });

          // ‚≠ê TARGET NEW FOOTER ELEMENT
          const timeElement = document.getElementById('footer-time');
          if (timeElement) {
              timeElement.textContent = `${dateString} | ${timeString}`;
          }
      }
      updateTime();
      setInterval(updateTime, 1000);
      const tabBar = document.getElementById('tab-bar');
      const bottomBar = document.getElementById('bottom-bar');

          function backToMain() {
              iframeContainer.style.display = 'none'; mainMenu.style.display = 'flex'; iframeEl.src = 'about:blank';
              // When going back to main, ensure the Home tab is visible
              showTab('home', document.getElementById('tab-home'));
              tabBar.style.display = 'flex';
               bottomBar.style.display = 'flex';

          }
          function goToHomepage() { iframeEl.src = currentHomepage; }
          function toggleFullscreen() {
              if (!document.fullscreenElement) iframeEl.requestFullscreen().catch(err => console.error(err)); else document.exitFullscreen();
          }

          // UPDATED FUNCTION: Open Iframe Content in New Window (with Cloak)
          function openIframeInNewWindow() {
              if (!iframeEl.src || iframeEl.src === 'about:blank') {
                  alert('Please load a game first! Also, HOW DID YOU GET THIS MESSAGE?!?!?!?!?');
                  return;
              }

              const title = document.title;
              const faviconURL = document.querySelector('link[rel="icon"], link[rel="shortcut icon"]')?.href || '';

              // Template for the new window content (using a nested iframe to display the game)
              const htmlContent = `
                  <!DOCTYPE html>
                  <html>
                  <head>
                      <meta charset="UTF-8">
                      <meta name="viewport" content="width=device-width, initial-scale=1.0">
                      <title>${title}</title>
                      ${faviconURL ? `<link rel="icon" href="${faviconURL}">` : ''}
                      <style>
                          body { margin: 0; padding: 0; overflow: hidden; background-color: #fff; }
                          iframe { width: 100vw; height: 100vh; border: none; margin: 0; padding: 0; }
                      </style>
                  </head>
                  <body>
                      <iframe src="${iframeEl.src}"></iframe>
                  </body>
                  </html>
              `;

              const newWindow = window.open('about:blank', '_blank');
              if (newWindow) {
                  newWindow.document.write(htmlContent);
                  newWindow.document.close();
              } else {
                  alert("Pop-up blocked! Please allow pop-ups for this site.");
              }
          }


          // --- THEME & APPEARANCE ---
          themeToggleBtn.innerHTML =  '<i class="fas fa-sun"></i>';
          function applyTheme(theme) {
              root.setAttribute('data-theme', theme);
              themeToggleBtn.innerHTML = theme === 'dark' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
              localStorage.setItem('theme', theme);
          }
          themeToggleBtn.addEventListener('click', () => {
              const newTheme = (root.getAttribute('data-theme') || 'light') === 'light' ? 'dark' : 'light';
              applyTheme(newTheme);
          });

          // NEW: Function to apply background pattern
          function applyPattern() {
              const patternSelect = document.getElementById('pattern-select');
              const selectedPattern = patternSelect.value;
              mainMenu.setAttribute('data-pattern', selectedPattern);
              localStorage.setItem('selectedPattern', selectedPattern);
          }

          // Check for saved theme and pattern on load
          document.addEventListener('DOMContentLoaded', () => {
              const savedTheme = localStorage.getItem('theme') || 'light';
              applyTheme(savedTheme);

              const savedPattern = localStorage.getItem('selectedPattern') || 'lines';
              document.getElementById('pattern-select').value = savedPattern;
              applyPattern(); // Apply the saved or default pattern
          });

      // Store references to the new elements
      const footerToggleButton = document.getElementById('footer-toggle');

      function toggleFooter() {
          const isEnabled = footerToggleButton.getAttribute('data-footer-enabled') === 'true';

          if (isEnabled) {
              // Disable: Hide the footer
              bottomBar.style.display = 'none';
              footerToggleButton.textContent = 'Show Footer';
              footerToggleButton.setAttribute('data-footer-enabled', 'false');
          } else {
              // Enable: Show the footer
              bottomBar.style.display = 'flex'; // Footer is a flex container
              footerToggleButton.textContent = 'Hide Footer';
              footerToggleButton.setAttribute('data-footer-enabled', 'true');
          }
      }
          function showIframe(url) {
              currentHomepage = url; mainMenu.style.display = 'none'; iframeContainer.style.display = 'block'; iframeEl.src = url;
              tabBar.style.display = 'none';


            toggleFooter();
             toggleFooter();
          }
      function refreshIframe() {
// 1. Get the current source URL.
// 1. Get the current URL that the iframe is *actually* displaying.
    // NOTE: This will only work if the content is SAME-ORIGIN! 
    // If it's cross-origin, you must use iframe.src (the original attribute value).
    let currentPath;
    try {
        currentPath = iframeEl.contentWindow.location.href;
    } catch (e) {
        // Fallback for cross-origin or security restriction: use the attribute value.
        currentPath = iframeEl.src; 
    }

    // 2. Create a new timestamp to use as a unique query parameter.
    const uniqueTimestamp = new Date().getTime();
    
    // 3. Construct the new, unique URL with a cache-buster.
    // Check if the URL already has query parameters (with '?') or not.
    const separator = currentPath.includes('?') ? '&' : '?';
    const newSrc = currentPath + separator + '_refresh=' + uniqueTimestamp;

    // 4. Set the new unique source, forcing a fresh load.
    iframeEl.src = newSrc;
    
    console.log('Iframe refresh triggered with cache-buster:', newSrc);}
    </script>
    <script>
      let blurEnabled = true;

      function updateBlurButton() {
          const btn = document.getElementById('blur-toggle');
          if (!btn) return;
          btn.textContent = blurEnabled ? 'Redirect: ON' : 'Redirect: OFF';
          btn.setAttribute('data-blur-enabled', blurEnabled);
          btn.style.backgroundColor = '';
      }

      function toggleBlur() {
          blurEnabled = !blurEnabled;
          updateBlurButton();
      }

      document.addEventListener('DOMContentLoaded', updateBlurButton);

      // --- Blur Redirect/Overlay Logic ---
      const REDIRECT_DELAY = 65;
      let timeoutHandle = null;

      function redirect() {
          clearTimeout(timeoutHandle);
          // Attempt fast tab closure/redirect
          window.location.href = "https://www.google.com";
      }

      document.addEventListener('visibilitychange', () => {
          if (document.visibilityState === 'hidden') {
              // Tab lost focus
              if (blurEnabled) {
                  // Blur ON: Initiate redirect
                  timeoutHandle = setTimeout(redirect, REDIRECT_DELAY);
              } else {
                  // Blur OFF: Show white overlay by hiding content
                  toggleContentVisibility(false);
              }
          } else {
              // Tab gained focus, clear any pending redirect
              if (timeoutHandle) {
                  clearTimeout(timeoutHandle);
                  timeoutHandle = null;
              }
              // If content was hidden by the overlay, we now wait for 'E' press
          }
      });

      window.addEventListener('focus', function () {
          if (timeoutHandle) {
              clearTimeout(timeoutHandle);
              timeoutHandle = null;
          }
      });

      // Logic: 'E' keypress to dismiss overlay and show content
      document.addEventListener('keydown', (event) => {
          // Only proceed if the overlay is visible
          if (overlay.style.display === 'flex') {
              // Check for 'E' keypress (case-insensitive)
              if (event.key.toUpperCase() === 'E') {
                  toggleContentVisibility(true);
                  event.preventDefault(); // Stop 'e' from typing in any focused input
              }
          }
      });
      // Logic: ' ' keypress to replace window with google
      document.addEventListener('keydown', (event) => {
          // Only proceed if the overlay is visible
          if (overlay.style.display === 'flex') {
              // Check for 'E' keypress (case-insensitive)
              if (event.key.toUpperCase() === ' ') {
          window.location.replace("https://google.com/")
                  event.preventDefault(); // Stop 'e' from typing in any focused input
              }
          }
      });
      // MODIFIED function for the dropdown
      function applyCloak() {
          const dropdown = document.getElementById('cloak-dropdown');
          const selected = dropdown.value;
          const customOptionsDiv = document.getElementById('custom-cloak-options');

          if (selected === "custom") {
              // Show the custom input fields
              customOptionsDiv.classList.add('visible');

          } else if (selected) {
              // A preset was chosen
              // Hide custom options
              customOptionsDiv.classList.remove('visible');

              // Apply the preset cloak
              document.title = selected;
              const faviconURL = FAVICONS[selected];
              let faviconEl = document.getElementById("dynamic-favicon");

              if (!faviconEl) {
                  faviconEl = document.createElement("link");
                  faviconEl.rel = "icon";
                  faviconEl.id = "dynamic-favicon";
                  document.head.appendChild(faviconEl);
              }
              faviconEl.href = faviconURL;

              // Clear custom inputs so the user knows the preset is active
              document.getElementById('custom-title-input').value = "";
              document.getElementById('custom-favicon-input').value = "";

          } else {
              // The "Select Preset..." (empty value) was chosen
              // Hide custom options
              customOptionsDiv.classList.remove('visible');
          }
      }
      // Function for custom inputs (no changes needed)
      function applyCustomCloak(customTitle, faviconURL) {
          if (customTitle) {
              document.title = customTitle;
          }
          if (faviconURL) {
              let faviconEl = document.getElementById("dynamic-favicon");
              if (!faviconEl) {
                  faviconEl = document.createElement("link");
                  faviconEl.rel = "icon";
                  faviconEl.id = "dynamic-favicon";
                  document.head.appendChild(faviconEl);
              }
              faviconEl.href = faviconURL;
          }
      }

      // MODIFIED Helper function for the "Apply Custom Cloak" button
      function runCustomCloak() {
          const title = document.getElementById('custom-title-input').value;
          const url = document.getElementById('custom-favicon-input').value;

          if (!title && !url) {
              alert("Please enter a title or favicon URL!");
              return;
          }

          applyCustomCloak(title, url);

          // Keep the preset dropdown on "Custom"
          document.getElementById('cloak-dropdown').value = "custom";
      }
      // --- Loading Screen Logic ---
      function hideLoadingScreen() {
          const loadingScreen = document.getElementById('loading-screen');
          if (loadingScreen) {
              loadingScreen.classList.add('hidden');
          }
      }



      // --- REPLACE YOUR OLD LOADING SCREEN LOGIC WITH THIS ---

      // --- Loading Screen Logic ---
      function hideLoadingScreen() {
          const loadingScreen = document.getElementById('loading-screen');
          if (loadingScreen) {
              loadingScreen.classList.add('hidden');
          }

          // --- NEW ---
          // Show the disclaimer *after* the loading screen is hidden
          // We wait a tiny bit for the loading screen to fade out
          setTimeout(()=>{                      showModal("Redirect on: redirects to google when tab unfocused/switched. \nRedirect off: covers screen white until you click screen then click 'E' (If you click 'SpaceBar' on the webpage, the webpage redirects to google)");
}, 500);
      }

      // Wait for the entire page to load (including images/resources)
      window.addEventListener('load', () => {
          // Hide the loading screen after a small delay
          setTimeout(hideLoadingScreen, 500);
      });

        // Get references to the modal elements
        const modal = document.getElementById('custom-modal');
        const modalMessage = document.getElementById('modal-message');

        // Global queue holds message and the Promise resolver function for that message
        const modalQueue = [];
        // State variable to prevent overlapping modals
        let isModalOpen = false;
        // The resolve function for the currently displayed modal's promise
        let currentResolver = null; 
        
        /**
         * Public function to queue or show a modal with a specified message.
         * Returns a Promise that resolves when the user dismisses the modal.
         * @param {string} Mssg The message to display inside the modal.
         * @returns {Promise<void>} A promise that resolves upon dismissal.
         */
        function showModal(Mssg) {
            return new Promise(resolve => {
                // 1. Add the new message and its resolver to the end of the queue
                modalQueue.push({ Mssg, resolve });
                console.log(`Message queued: "${Mssg.substring(0, 15)}...". Queue size: ${modalQueue.length}`);

                // 2. Try to process the queue immediately
                processQueue();
            });
        }
        
        /**
         * Processes the next message in the queue and displays the modal if it's currently closed.
         */
        function processQueue() {
            if (modalQueue.length > 0 && !isModalOpen) {
                isModalOpen = true;

                // Get the oldest message and its resolver from the front of the queue
                const nextItem = modalQueue.shift();
                
                // Store the resolver so closeModal can use it
                currentResolver = nextItem.resolve; 

                // --- FIX: Replace \n with <br> and use innerHTML ---
                // We use innerHTML to allow the <br> tags to render correctly.
                const htmlMessage = nextItem.Mssg.replace(/\n/g, '<br>');

                // 1. Update the message content using innerHTML
                modalMessage.innerHTML = htmlMessage;

                // 2. Make the modal visible and activate the transition
                modal.classList.add('active');
                
                // 3. Set focus to the close button for accessibility
                modal.querySelector('button').focus();
            }
        }
        
        /**
         * Hides the current modal, resolves the waiting promise, and triggers the next one in the queue.
         */
        function closeModal() {
            // Check if a modal is actually open
            if (!isModalOpen) return;
            
            // 1. Hide the modal visually
            modal.classList.remove('active');

            // 2. Set state to closed
            isModalOpen = false;
            
            // 3. Resolve the promise for the modal that was just closed
            if (currentResolver) {
                currentResolver();
                currentResolver = null; // Clear the resolver
            }
            
            // 4. Wait slightly for the CSS transition to complete (0.3s) before processing the next one
            setTimeout(() => {
                // Try to process the next message in the queue
                processQueue();
            }, 300); // 300ms matches the CSS transition duration
        }
        
        // --- YOUR SPECIFIC USE CASE (Fixed) ---
        /**
         * This function demonstrates how to correctly pause the script.
         * It must be async, and must use 'await' before showModal.
         */
        async function openPlaylist() {
            // 1. The script PAUSES here until the user dismisses the modal.
            await showModal("If you judge my music or play it out loud to the class, I will punch you, slice you, grate you, burn you, put you in the oven, feed you to dogs, hang you, cut you, choke you, kick you, whip you, and dump you out.");
            
            // 2. This line only runs AFTER the user closes the modal.
            showIframe('https://starlightgg.github.io/playlist');
        }




        // Event Listeners for closing the modal (these still call closeModal)
        modal.addEventListener('click', (event) => {
            if (event.target === modal) {
                closeModal();
            }
        });

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && modal.classList.contains('active')) {
                closeModal();
            }
        });
    </script>
<script>
// Wrap the entire script execution in DOMContentLoaded to ensure all HTML elements
// are loaded and available before the script attempts to find them.
document.addEventListener('DOMContentLoaded', () => {

    const infoBtn = document.getElementById('info-btn');
    const modal = document.getElementById('performance-modal');
    const fpsValue = document.getElementById('fps-value');
    const pingValue = document.getElementById('ping-value');

    // CRITICAL: Check if the required elements were found. If they are missing, the script will not run.
    if (!infoBtn || !modal || !fpsValue || !pingValue) {
        console.error("Performance Monitor Error: One or more required HTML elements (info-btn, performance-modal, fps-value, ping-value) are missing from the page. The script cannot initialize.");
        return; 
    }

    let isModalVisible = false;

    // Helper function to update the color class
    function updateColorClass(element, newClass) {
        const colorClasses = ['text-good', 'text-medium', 'text-bad', 'text-default'];
        colorClasses.forEach(c => element.classList.remove(c));
        element.classList.add(newClass);
    }

    // --- 1. Reusable Draggable Logic ---
    function makeDraggable(element, clickCallback, followerElement) {
        let isDragging = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;
        let moved = false; // Tracks if a significant move actually occurred
        const VERTICAL_GAP = 16; // Fixed gap value (16px = 1rem) for vertical separation
        
        // Element to block mouse events over iframes during drag
        let dragOverlay = null; 

        // Function to create and add the full-screen overlay
        function addDragOverlay() {
            dragOverlay = document.createElement('div');
            dragOverlay.style.position = 'fixed';
            dragOverlay.style.top = '0';
            dragOverlay.style.left = '0';
            dragOverlay.style.width = '100vw';
            dragOverlay.style.height = '100vh';
            dragOverlay.style.zIndex = '9999'; // Very high z-index to cover everything
            dragOverlay.style.cursor = 'move'; // Show the move cursor while dragging
            dragOverlay.style.backgroundColor = 'transparent';
            document.body.appendChild(dragOverlay);
        }

        // Function to remove the overlay
        function removeDragOverlay() {
            if (dragOverlay) {
                document.body.removeChild(dragOverlay);
                dragOverlay = null;
            }
        }

        function startDrag(e) {
            e.preventDefault();
            moved = false;
            
            // Add the overlay at the start of the drag to handle iframes
            addDragOverlay();

            // Aggressively ensure elements are set to fixed position and convert 
            // the current visual position (from CSS like bottom/right) to explicit top/left coordinates.

            // 1. Configure the main draggable element (infoBtn)
            element.style.position = 'fixed'; 
            const rect = element.getBoundingClientRect();
            element.style.right = ''; // Clear original CSS positioning
            element.style.bottom = '';
            element.style.top = rect.top + 'px';
            element.style.left = rect.left + 'px';
            
            // 2. Configure the follower element (modal) if visible
            if (followerElement && isModalVisible) {
                followerElement.style.position = 'fixed'; 
                const followerRect = followerElement.getBoundingClientRect();
                followerElement.style.right = ''; // Clear original CSS positioning
                followerElement.style.bottom = '';
                followerElement.style.top = followerRect.top + 'px';
                followerElement.style.left = followerRect.left + 'px';
            }

            // Calculate offset based on the now-fixed position
            dragOffsetX = e.clientX - element.getBoundingClientRect().left;
            dragOffsetY = e.clientY - element.getBoundingClientRect().top;

            isDragging = true;
            
            // Attach mouse events to the document so they can't be lost easily
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('mousemove', handleDrag);
        }

        function handleDrag(e) {
            e.preventDefault();
            if (!isDragging) return;

            // Detect movement to prevent accidental clicks
            // Threshold of 5px to distinguish a click from a drag
            if (Math.abs(e.movementX) > 5 || Math.abs(e.movementY) > 5) {
                moved = true;
            }

            let newLeft = e.clientX - dragOffsetX;
            let newTop = e.clientY - dragOffsetY;

            // Boundary checks for the main element (Button)
            if (newLeft < 0) newLeft = 0;
            if (newTop < 0) newTop = 0;
            if (newLeft + element.offsetWidth > window.innerWidth) newLeft = window.innerWidth - element.offsetWidth;
            if (newTop + element.offsetHeight > window.innerHeight) newTop = window.innerHeight - element.offsetHeight;

            element.style.top = newTop + "px";
            element.style.left = newLeft + "px";

            // Update the follower element's position (the modal)
            if (followerElement && isModalVisible) {
                const B_width = element.offsetWidth;
                const M_width = followerElement.offsetWidth;
                const M_height = followerElement.offsetHeight;

                // Initial Modal position: Above and right-aligned with the button
                let M_top = newTop - M_height - VERTICAL_GAP;
                let M_left = newLeft + B_width - M_width;

                // *** NEW: Boundary checks for the follower modal during drag ***
                if (M_top < 0) M_top = 0; // Prevent top overflow
                if (M_left < 0) M_left = 0; // Prevent left overflow
                if (M_left + M_width > window.innerWidth) M_left = window.innerWidth - M_width; // Prevent right overflow
                if (M_top + M_height > window.innerHeight) M_top = window.innerHeight - M_height; // Prevent bottom overflow

                followerElement.style.top = M_top + "px";
                followerElement.style.left = M_left + "px";
            }
        }

        function endDrag() {
            isDragging = false;
            removeDragOverlay(); // Remove the overlay at the end of the drag
            document.removeEventListener('mouseup', endDrag);
            document.removeEventListener('mousemove', handleDrag);

            // CRITICAL FIX: Trigger the click action only if no movement occurred.
            if (!moved && clickCallback) {
                clickCallback();
            }
        }

        // Attach the mouse down handler
        element.onmousedown = startDrag;
    }

    // --- 2. Modal Toggle Callback ---
    const toggleModal = () => {
        isModalVisible = !isModalVisible;
        if (isModalVisible) {
            // Show modal
            modal.style.opacity = '1';
            modal.style.transform = 'translateY(0)'; 
            modal.style.pointerEvents = 'auto';
            
            // Reposition modal relative to the button when opened
            const B_rect = infoBtn.getBoundingClientRect();
            const M_width = modal.offsetWidth;
            const M_height = modal.offsetHeight;
            const B_width = infoBtn.offsetWidth;
            const VERTICAL_GAP = 16;
            
            // Calculate initial position (Above and right-aligned)
            let M_top = B_rect.top - M_height - VERTICAL_GAP;
            let M_left = B_rect.left + B_width - M_width;

            // *** NEW: Boundary checks for the modal when first opened (Click/Tap) ***
            if (M_top < 0) M_top = 0; // Prevent top overflow
            if (M_left < 0) M_left = 0; // Prevent left overflow
            if (M_left + M_width > window.innerWidth) M_left = window.innerWidth - M_width; // Prevent right overflow
            if (M_top + M_height > window.innerHeight) M_top = window.innerHeight - M_height; // Prevent bottom overflow

            modal.style.top = M_top + 'px';
            modal.style.left = M_left + 'px';
            
            measurePing();
        } else {
            // Hide modal
            modal.style.opacity = '0';
            modal.style.transform = 'translateY(10px)';
            modal.style.pointerEvents = 'none';
        }
    };

    // --- 3. Apply Draggable Logic ---

    // Make the Floating Info Button draggable and set its click action, 
    // with the modal as its follower element.
    makeDraggable(infoBtn, toggleModal, modal);

    // --- 4. FPS Calculation Logic (Unchanged) ---

    let lastFrameTime = performance.now();
    let frameCount = 0;
    const fpsInterval = 250; // Update FPS every 0.25 seconds (more responsive)
    let fpsTimer = 0;

    function updateFPS(currentTime) {
        if (!fpsTimer) fpsTimer = currentTime;
        frameCount++;

        if (currentTime >= fpsTimer + fpsInterval) {
            const timeElapsed = currentTime - fpsTimer;
            const currentFPS = (frameCount / timeElapsed) * 1000;

            if (isModalVisible) {
                fpsValue.textContent = Math.round(currentFPS);

                let colorClass = 'text-bad';
                if (currentFPS > 55) {
                    colorClass = 'text-good';
                } else if (currentFPS > 30) {
                    colorClass = 'text-medium';
                }
                updateColorClass(fpsValue, colorClass);
            }
            fpsTimer = currentTime;
            frameCount = 0;
        }
        requestAnimationFrame(updateFPS);
    }

    // Start the FPS loop
    requestAnimationFrame(updateFPS);


    // --- 5. Ping (Latency) Measurement Logic (Unchanged) ---

    const PING_URL = 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js';
    const PING_INTERVAL_MS = 1000; // Check ping every 1 second (more responsive)

    async function measurePing() {
        if (!isModalVisible) return;

        pingValue.textContent = '...'; 
        updateColorClass(pingValue, 'text-default');

        try {
            const startTime = performance.now();
            // Using a well-known CDN resource to measure general network latency
            await fetch(PING_URL, {
                method: 'GET',
                mode: 'cors',
                cache: 'reload'
            });

            const endTime = performance.now();
            const latency = Math.round(endTime - startTime);

            pingValue.textContent = latency;

            let colorClass = 'text-bad';
            if (latency < 100) {
                colorClass = 'text-good';
            } else if (latency < 250) {
                colorClass = 'text-medium';
            }
            updateColorClass(pingValue, colorClass);

        } catch (error) {
            console.error("Ping error:", error);
            pingValue.textContent = 'Error';
            updateColorClass(pingValue, 'text-bad');
        }
    }

    // Periodically check ping
    setInterval(measurePing, PING_INTERVAL_MS);
}); // End of DOMContentLoaded
</script>
  </body>
</html>
